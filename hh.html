<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rooms - OFPPT MET</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#0f1720;
      --muted:#9aa5b1;
      --accent:#5865f2; /* Discord-like accent */
      --glass: rgba(255,255,255,0.03);
      font-family: "Segoe UI", Tahoma, system-ui, -apple-system, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      background: linear-gradient(180deg,#071024 0%, #071028 60%);
      color:#e6eef6;
      padding:28px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      gap:20px;
    }

    .container{
      width:100%;
      max-width:1100px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }
    header h1{
      margin:0;
      font-size:20px;
      letter-spacing:0.2px;
    }
    header p{margin:0;color:var(--muted);font-size:13px}

    .rooms-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:14px;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      padding:14px;
      border-radius:12px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      display:flex;
      flex-direction:column;
      gap:10px;
      transition:transform .18s ease, box-shadow .18s ease;
    }
    .card:hover{ transform: translateY(-6px); box-shadow: 0 14px 30px rgba(2,6,23,0.7); }

    .room-head{
      display:flex;
      gap:12px;
      align-items:center;
    }
    .avatar{
      width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent), #2e63ff);
      display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;
      color:white;flex:0 0 56px;
    }
    .meta{flex:1}
    .meta h3{margin:0;font-size:16px}
    .meta p{margin:0;color:var(--muted);font-size:13px;margin-top:6px}

    .stats{
      display:flex;
      gap:8px;
      color:var(--muted);
      font-size:13px;
      align-items:center;
    }

    .actions{
      display:flex;
      gap:8px;
      margin-top:6px;
    }
    .btn{
      appearance:none;
      border:0;
      padding:8px 12px;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      background:var(--glass);
      color:var(--muted);
      transition:all .12s ease;
    }
    .btn:hover{ transform:translateY(-2px) }
    .btn-join{
      background:linear-gradient(90deg,var(--accent), #3b58ff);
      color:white;
      box-shadow: 0 6px 18px rgba(88,101,242,0.16);
    }
    .btn-copy{ background: rgba(255,255,255,0.02); color:var(--muted) }

    /* small footer + add-room form */
    .add-room{
      margin-top:18px;
      display:flex;
      gap:8px;
      align-items:center;
      background:rgba(255,255,255,0.02);
      padding:10px;border-radius:10px;
    }
    .add-room input, .add-room select{
      padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);
      background:transparent;color:inherit;outline:none;font-size:14px;
    }

    .note{ color:var(--muted); font-size:13px; margin-top:8px; }

    /* responsive */
    @media (max-width:420px){
      .avatar{width:48px;height:48px}
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <h1>Rooms (Discord)</h1>
      <p>دير كل شعبة link مباشر لِـ Discord — الناس يدخلو عبر Invite أو يفتح التطبيق.</p>
    </div>
    <div class="note">كل زر "Join" يفتح invite فـ تاب جديد.</div>
  </header>

  <main>
    <div class="rooms-grid" id="roomsGrid">
      <!-- Cards generated by JS -->
    </div>

    <!-- Add room (optional, client-side) -->
    <div class="add-room" aria-hidden="false" style="margin-top:16px;">
      <input id="roomName" placeholder="إسم الشعبة (مثال: Électricité)" />
      <input id="inviteCode" placeholder="Invite code (مثال: discord.gg/abcd)" />
      <button class="btn btn-join" id="addBtn">Add room</button>
    </div>

    <p class="note">باش تغيّر Invite: عطينا invite كامل (مثال: <code>https://discord.gg/abcd</code>) أو الرمز فقط (<code>abcd</code>).</p>
  </main>
</div>

<script>
/*
  Sample rooms data.
  Replace invite values with your actual invites (full URL or code).
  When user clicks Join -> opens the invite in a new tab (which on mobile/desktop
  usually suggests opening the Discord app if installed).
*/
const rooms = [
  { id: 'elec', name: 'Électricité', desc: 'غرفة ديال شعبة الكهرباء', members: 128, avatarText: 'E', invite: 'https://discord.gg/EXAMPLE1' },
  { id: 'info', name: 'Informatique', desc: 'غرفة ديال شعبة المعلوماتية', members: 240, avatarText: 'I', invite: 'https://discord.gg/EXAMPLE2' },
  { id: 'meca', name: 'Mécanique', desc: 'غرفة ديال الميكانيك', members: 90, avatarText: 'M', invite: 'https://discord.gg/EXAMPLE3' }
];

const roomsGrid = document.getElementById('roomsGrid');

function makeCard(r){
  // Normalize invite: if user provided only code like "abcd", convert to https://discord.gg/abcd
  let inviteUrl = r.invite || '';
  if(inviteUrl && !inviteUrl.startsWith('http')){
    // allow codes like 'abcd' or 'discord.gg/abcd'
    if(inviteUrl.startsWith('discord.gg')) inviteUrl = 'https://' + inviteUrl;
    else inviteUrl = 'https://discord.gg/' + inviteUrl;
  }

  const card = document.createElement('div');
  card.className = 'card';
  card.innerHTML = `
    <div class="room-head">
      <div class="avatar" aria-hidden="true">${escapeHtml(r.avatarText || r.name[0] || '?')}</div>
      <div class="meta">
        <h3>${escapeHtml(r.name)}</h3>
        <p>${escapeHtml(r.desc || '')}</p>
        <div class="stats" style="margin-top:8px">
          <span>👥 ${Number(r.members || 0)}</span>
        </div>
      </div>
    </div>
    <div class="actions" role="group" aria-label="actions for ${escapeHtml(r.name)}">
      <button class="btn btn-join" title="Open in Discord or browser" data-invite="${escapeAttr(inviteUrl)}">Join</button>
      <button class="btn btn-copy" title="Copy invite link" data-invite="${escapeAttr(inviteUrl)}">Copy Link</button>
    </div>
  `;

  // attach events
  const joinBtn = card.querySelector('.btn-join');
  joinBtn.addEventListener('click', () => {
    if(!inviteUrl){ alert('No invite set for this room.'); return; }
    // open new tab/window
    window.open(inviteUrl, '_blank', 'noopener');
  });

  const copyBtn = card.querySelector('.btn-copy');
  copyBtn.addEventListener('click', async () => {
    if(!inviteUrl){ alert('No invite set for this room.'); return; }
    try{
      await navigator.clipboard.writeText(inviteUrl);
      copyBtn.textContent = 'Copied ✓';
      setTimeout(()=> copyBtn.textContent = 'Copy Link', 1200);
    }catch(err){
      // fallback: open prompt
      const ok = confirm('Clipboard not available — هل تبغي تفتح الرابط فـ تاب جديد؟');
      if(ok) window.open(inviteUrl, '_blank', 'noopener');
    }
  });

  return card;
}

function renderAll(){
  roomsGrid.innerHTML = '';
  rooms.forEach(r => roomsGrid.appendChild(makeCard(r)));
}

// utils: sanitize simple strings for text/html
function escapeHtml(s){
  if(!s) return '';
  return String(s).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
}
function escapeAttr(s){ return escapeHtml(s); }

renderAll();

/* Add room client-side (optional). In real app, you'd send to server */
document.getElementById('addBtn').addEventListener('click', ()=>{
  const name = document.getElementById('roomName').value.trim();
  const invite = document.getElementById('inviteCode').value.trim();
  if(!name || !invite){ alert('عمر الإسم والرابط/الرمز'); return; }
  const newRoom = {
    id: 'r_'+Date.now(),
    name,
    desc: 'غرفة جديدة',
    members: 0,
    avatarText: name[0] || '?',
    invite
  };
  rooms.push(newRoom);
  renderAll();
  document.getElementById('roomName').value = '';
  document.getElementById('inviteCode').value = '';
});
</script>
</body>
</html>